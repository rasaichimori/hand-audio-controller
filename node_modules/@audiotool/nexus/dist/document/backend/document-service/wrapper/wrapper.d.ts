import { DocumentService } from '../../../../gen/audiotool/document/v1/document_service_connect';
import { Transaction } from '../../../../gen/audiotool/document/v1/document_service_pb';
import { RetryingClient } from '../../../../utils/grpc/retrying-client';
import { ObservableValue } from '../../../../utils/observable-notifier-value';

/** To get access to the connection from the debug view */
export declare let debugGlobalWrapper: ReturnType<typeof createDocumentServiceWrapper> | undefined;
/** Lightly wraps the methods of document service to make them more useful, e.g. handling
 * disconnection, ping, and turning streaming methods into simple methods.
 */
export type DocumentServiceWrapper = {
    /** Get the next transaction sent from the backend. On disconnect, just blocks until
     * reconnection. Throws only if unrecoverable. The very first transaction will "load" the current document
     * state, which might be empty if the document is new.
     */
    receiveNextTransaction: () => Promise<Transaction>;
    /** Send the next transaction to the backend. Resolves with a string describing issue if transaction
     * was rejected by backend, otherwise undefined. If disconnected, will just block until
     * reconnected.
     */
    sendNextTransaction: (t: Transaction) => Promise<string | undefined>;
    /** Current ping to server, in milliseconds. Updated at most every 1000ms. If no ping returns,
     * this value doesn't update (todo).
     */
    ping: ObservableValue<number>;
    /** This value becomes false if the network connection to the backend is interrupted. The other methods
     * continue to work, just don't resolve, and buffer until the connection is reestablished.
     */
    connectionOk: ObservableValue<boolean>;
};
export declare const createDocumentServiceWrapper: ({ projectName, pingIntervalMs, backoffMs, documentService, }: {
    projectName: string;
    /** How often ping is called; determines how faster disconnects are noticed. Can be undefined to avoid
     * calling altogether; useful during testing to avoid unhandled promise rejections.
     */
    pingIntervalMs?: number;
    /** How much to wait before reconnecting on connection error.*/
    backoffMs?: number;
    /** only for unit tests */
    documentService: RetryingClient<typeof DocumentService>;
}) => DocumentServiceWrapper;
