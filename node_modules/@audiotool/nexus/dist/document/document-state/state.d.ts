import { EntityTypeKey } from '../entity-utils';
import { Modification } from '../../gen/audiotool/document/v1/document_service_pb';
import { NexusEntity, NexusEntityUnion } from '../entity';
import { PrimitiveType } from '../fields';
import { NexusLocation } from '../location';

export type ModificationCallbacks = {
    onStartPointingTo: (from: NexusLocation, to: NexusLocation) => void;
    onStopPointingTo: (from: NexusLocation, to: NexusLocation) => void;
    onUpdate: (location: NexusLocation, value: PrimitiveType) => void;
    onCreate: (entity: NexusEntity) => void;
    onDelete: (entity: NexusEntity) => void;
};
/**
 * @internal
 * This type represents the current "state" of the Nexus document that can be updated
 * with modifications. It is the primary place where entities are "stored".
 */
export type NexusDocumentState = {
    /** Holds all entities currently in the document. */
    readonly entities: ReadonlyMap<string, NexusEntityUnion>;
    /** Holds all references in the document. `references[loc]` contains all locations
     * pointing to `loc`.
     */
    readonly references: ReadonlyMap<NexusLocation, NexusLocation[]>;
    /** Apply a modification to the document state. */
    applyModification(modification: Modification): void;
    /** Calculate statistics for debugging purposes. */
    getStats(): {
        entities: number;
        references: number;
    };
    /** for unit testing, let's us make an id resolve to a specific entity type when constructing location */
    _addEntityTypeForId(id: string, entityType: EntityTypeKey): void;
};
export declare const nexusDocumentState: (props?: {
    entities?: Map<string, NexusEntity>;
    references?: Map<NexusLocation, NexusLocation[]>;
    callbacks?: Partial<ModificationCallbacks>;
}) => NexusDocumentState;
